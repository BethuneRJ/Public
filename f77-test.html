<!DOCTYPE html>
<html lang="en" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">

	<link rel='shortcut icon' type='image/x-icon' href='https://cdn.jsdelivr.net/gh/BethuneRJ/Public@main/orion-favicon.png' />
	<link rel="stylesheet" media="screen" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.dark.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BethuneRJ/Public@latest/stylesheet.css">
	<link href="https://fonts.cdnfonts.com/css/inter" rel="stylesheet">
	
	<title>F-77</title>
		
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://kit.fontawesome.com/1c83dba55c.js" crossorigin="anonymous"></script>

</head>
<body>
	<nav class="navbar navbar-expand-lg printHide">
		<div class="container-fluid">
				<span class="navbar-brand text-uppercase">
					<a class="navbar-brand" href="../cop.aspx">
						<img class="me-2" height="36" src="https://cdn.jsdelivr.net/gh/BethuneRJ/Public@main/orion-symbol-white.svg" alt="ORION" loading="lazy" />
					</a>
					F-77 POTENTIAL EVACUEES
				</span>
			</div>
		</div>
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-4 col-md-6 col-sm-12">
				<div class="card mt-4 bgColour">
					<div class="card-body">
						<div>
							<a class="me-3 h5" href="javascript:void(0)" onclick="fnF77Zone(1)">AF</a> 
							<a class="me-3 h5" href="javascript:void(0)" onclick="fnF77Zone(2)">EAP</a>
							<a class="me-3 h5" href="javascript:void(0)" onclick="fnF77Zone(3)">EUR</a>
							<a class="me-3 h5" href="javascript:void(0)" onclick="fnF77Zone(4)">NEA</a>
							<a class="me-3 h5" href="javascript:void(0)" onclick="fnF77Zone(5)">SCA</a>
							<a class="h5" href="javascript:void(0)" onclick="fnF77Zone(7)">WHA</a>
						</div>
						<div class="text-muted"><i>Select a region above.</i></div>
						<h5 class="mt-4" id="region"></h5>
						<div id="f77-zone-report"></div>
					</div>
				</div>
			</div>
			<div id="column-2" class="col-lg-4 col-md-6 col-sm-12">
				<div class="card mt-4 bgColour">
					<div class="card-body">
						<div>
							<form class="form-inline">
								<div class="md-form my-0">
									<div class="input-group">
										<select class="browser-default custom-select" id="country-list"></select>
										<button id="country-list-btn" class="btn btn-md btn-custom" type="button">Load</button>
									</div>
								</div>
							</form>
						</div>
						<div class="text-muted"><i>Select a country above.</i></div>
						<h5 class="mt-4" id="country"></h5>
						<div id="f77-country-report"></div>
					</div>
				</div>
			</div>
			<div id="column-3" class="col-lg-4 col-md-6 col-sm-12">
				<div class="card mt-4 bgColour">
					<div class="card-body">
						<div id="post-list"></div>
						<div class="text-muted"><i>Select a post above.</i></div>
						<h5 class="mt-4" id="post"></h5>
						<div id="f77-post-report"></div>
						<div class="mt-2" id="f77-post-approval-date"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="mt-auto" id="footer"></div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.40/moment-timezone-with-data.min.js" integrity="sha512-dPDHjz++pU63luykSOhkUQw82AZdbQHk7LQNKrU7kuRGmdR9mbPFu/vYAmCgZ+TXk8vHygzCkV6Ixck+NIOeDA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js" integrity="sha512-LUKzDoJKOLqnxGWWIBM4lzRBlxcva2ZTztO8bTcWPmDSpkErWx0bSP4pdsjNH8kiHAUPaT06UXcb+vOEZH+HpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.1.2/chart.umd.js" integrity="sha512-t41WshQCxr9T3SWH3DBZoDnAT9gfVLtQS+NKO60fdAwScoB37rXtdxT/oKe986G0BFnP4mtGzXxuYpHrMoMJLA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
	<script type="text/javascript">
		
		$(function() {
			$("#footer").load("https://usdos.sharepoint.com/:u:/r/sites/SES/ExecTech/DevOps/CMS/SiteAssets/references/footer.aspx?csf=1&web=1&e=DvZ7Vb");
			$("#column-2").hide();
			$("#column-3").hide();
		
			$("#country-list-btn").click(function () {
				var countryID = $("#country-list").val();
				fn77CountryReport(countryID);
			});
			
		});
		
		function fnF77Zone(zone) {
			$("#f77-country-report,#country").empty();
			$("#f77-post-report,#post,#post-list").empty();
			var region = '';
			switch(parseInt(zone)) {
				case 1:
					region = "Africa (AF)";
					break;
				case 2:
					region = "East Asia and Pacific (EAP)";
					break;
				case 3:
					region = "Europe (EUR)";
					break;
				case 4:
					region = "Near Eastern Affairs (NEA)";
					break;
				case 5:
					region = "South Central Asia (SCA)";
					break;
				case 7:
					region = "Western Hemisphere Affairs (WHA)";
					break;
			}
			$("#region").html(region);
			var settings = {
				"url": "https://sesapi.azure-api.net/f77/v1/api/ReportInstances/customzonereportwithcurrentdata",
				"method": "POST",
				"timeout": 0,
				"headers": {
					"Ocp-Apim-Subscription-Key": "545279035abb4093ad17a0b7e0fbac55",
					"Content-Type": "application/json-patch+json",
					"Cache-Control": "no-cache"
				},
				"data": JSON.stringify({
					"Item1": [
						zone
					],
					"Item2": [],
					"Item3": [],
					"Item4": []
				}),
			};
			$.ajax(settings).done(function (response) {
				console.log(response);
				let ttlpotevacuees = "<div><span class='text-muted'>Total Potential Evacuees:</span> "+addCommas(response.reportSections[0].reportData.fields[0].value)+"</div>";
				let ttlcitizens = "<div><span class='text-muted'>Total U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[1].value)+"</div>";
				let ttlnoncitizens = "<div><span class='text-muted'>Total Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[2].value)+"</div>";
				let ttlpotevacueescom = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Require to Evacuate:</span> "+addCommas(response.reportSections[0].reportData.fields[3].value)+"</div>";
				let usgemp = "<div><span class='text-muted'>USG Employees:</span> "+addCommas(response.reportSections[0].reportData.fields[4].value)+"</div>";
				let familymem = "<div><span class='text-muted'>Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[5].value)+"</div>";
				let tcncont = "<div><span class='text-muted'>TCN Contractors:</span> "+addCommas(response.reportSections[0].reportData.fields[6].value)+"</div>";
				let tcncontfamily = "<div><span class='text-muted'>TCN Contractors Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[7].value)+"</div>";
				let ttlevacuees = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Not Require to Evacuate</span> "+addCommas(response.reportSections[0].reportData.fields[8].value)+"</div>";
				let citizens = "<div><span class='text-muted'>U.S. Citizens (Residents and Visitors):</span> "+addCommas(response.reportSections[0].reportData.fields[9].value)+"</div>";
				let noncitizens = "<div><span class='text-muted'>Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[10].value)+"</div>";
				let ttlfamilymen = "<div><span class='text-muted'>Regional COCOM Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[11].value)+"</div>";
				let ttlpeacecorp = "<div><span class='text-muted'>Peace Corps Volunteers and Trainees:</span> "+addCommas(response.reportSections[0].reportData.fields[12].value)+"</div>";
				$("#f77-zone-report").html(ttlpotevacuees+ttlcitizens+ttlnoncitizens+ttlpotevacueescom+usgemp+familymem+tcncont+tcncontfamily+ttlevacuees+citizens+noncitizens+ttlfamilymen+ttlpeacecorp);
			});
			$("#column-2").show();
			fnF77GetCountries(zone);
		}
		
		function fnF77GetCountries(zone) {
			$("#f77-post-report").empty();
			var countryArray = [];
			var header = { headers: {
				'Accept': 'application/json',
				'Ocp-Apim-Subscription-Key': '545279035abb4093ad17a0b7e0fbac55',
				'Cache-Control': 'no-cache'} 
			};
			var url = "https://sesapi.azure-api.net/f77/v1/api/Country";
			axios.get(url, header).then(function (response) {
				console.log(response);
				$(response.data).each(function(n, i) {
					if (zone == i.zoneID) {
						countryArray.push({countryName: i.countryName, lastActivityDate: i.lastActivityDate, countryID: i.id});
					};
				});
				console.log(countryArray);
			}).then(function (response) {
				let countryList = '';
				$(countryArray).each(function(n, i) {
					countryList += "<option value='"+i.countryID+"'>"+i.countryName+"</option>";
				});
				$("#country-list").html(countryList);
			}).catch((error) => {
				$("#country-list").html("<i class='fa-solid fa-bug'></i> Error. Missing data.");
			});
		}
		
		function fnF77GetPosts(countryId) {
			$("#column-3").show();
			$("#f77-post-report,#post").empty();
			$("#post-list").html("<div class='spinner-border spinner-border-sm' role='status'><span class='visually-hidden'>Loading...</span></div>");
			var postArray = [];
			var header = { headers: {
				'Accept': 'application/json',
				'Ocp-Apim-Subscription-Key': '545279035abb4093ad17a0b7e0fbac55',
				'Cache-Control': 'no-cache'} 
			};
			var url = "https://sesapi.azure-api.net/f77/v1/api/Post";
			axios.get(url, header).then(function (response) {
				console.log(response);
				$(response.data).each(function(n, i) {
					if (countryId == i.countryID) {
						postArray.push({postName: i.postName, lastActivityDate: i.lastActivityDate, postID: i.id});
					};
				});
				console.log(postArray);
			}).then(function (response) {
				let postList = '';
				$(postArray).each(function(n, i) {
					postList += "<a class='me-3 h5 text-uppercase' href='JavaScript:void(0);' onclick='fnF77PostReport("+i.postID+");'>"+i.postName+"</a>";
				});
				$("#post-list").html(postList);
				console.log(postList);
			}).catch((error) => {
				$("#post-list").html("<i class='fa-solid fa-bug'></i> Error. Missing data.");
			});
		}
		
		function fn77CountryReport(countryID) {
			$("#f77-country-report").html("<div class='spinner-border spinner-border-sm' role='status'><span class='visually-hidden'>Loading...</span></div>");
			var settings = {
				"url": "https://sesapi.azure-api.net/f77/v1/api/ReportInstances/customcountryreportwithcurrentdata",
				"method": "POST",
				"timeout": 0,
				"headers": {
					"Ocp-Apim-Subscription-Key": "545279035abb4093ad17a0b7e0fbac55",
					"Content-Type": "application/json-patch+json",
					"Cache-Control": "no-cache"
				},
				"data": JSON.stringify({
					"Item1": [
						countryID
					],
					"Item2": [],
					"Item3": [],
					"Item4": []
				}),
			};
			$.ajax(settings).done(function (response) {
				console.log(response);
				$("#country").html(response.reportHeader.title);
				let ttlpotevacuees = "<div><span class='text-muted'>Total Potential Evacuees:</span> "+addCommas(response.reportSections[0].reportData.fields[0].value)+"</div>";
				let ttlcitizens = "<div><span class='text-muted'>Total U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[1].value)+"</div>";
				let ttlnoncitizens = "<div><span class='text-muted'>Total Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[2].value)+"</div>";
				let ttlpotevacueescom = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Require to Evacuate:</span> "+addCommas(response.reportSections[0].reportData.fields[3].value)+"</div>";
				let usgemp = "<div><span class='text-muted'>USG Employees:</span> "+addCommas(response.reportSections[0].reportData.fields[4].value)+"</div>";
				let familymem = "<div><span class='text-muted'>Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[5].value)+"</div>";
				let tcncont = "<div><span class='text-muted'>TCN Contractors:</span> "+addCommas(response.reportSections[0].reportData.fields[6].value)+"</div>";
				let tcncontfamily = "<div><span class='text-muted'>TCN Contractors Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[7].value)+"</div>";
				let ttlevacuees = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Not Require to Evacuate</span> "+addCommas(response.reportSections[0].reportData.fields[8].value)+"</div>";
				let citizens = "<div><span class='text-muted'>U.S. Citizens (Residents and Visitors):</span> "+addCommas(response.reportSections[0].reportData.fields[9].value)+"</div>";
				let noncitizens = "<div><span class='text-muted'>Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[10].value)+"</div>";
				let ttlfamilymen = "<div><span class='text-muted'>Regional COCOM Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[11].value)+"</div>";
				let ttlpeacecorp = "<div><span class='text-muted'>Peace Corps Volunteers and Trainees:</span> "+addCommas(response.reportSections[0].reportData.fields[12].value)+"</div>";
				$("#f77-country-report").html(ttlpotevacuees+ttlcitizens+ttlnoncitizens+ttlpotevacueescom+usgemp+familymem+tcncont+tcncontfamily+ttlevacuees+citizens+noncitizens+ttlfamilymen+ttlpeacecorp);
			}).fail(function () {
				$("#f77-country-report").html("<i class='fa-solid fa-bug'></i> Error. Missing data.");
			});
			fnF77GetPosts(countryID);
		}
		
		function fnF77PostReport(postID) {
			$("#f77-post-report").html("<div class='spinner-border spinner-border-sm' role='status'><span class='visually-hidden'>Loading...</span></div>");
			var settings = {
				"url": "https://sesapi.azure-api.net/f77/v1/api//ReportInstances/custompostreportwithcurrentdata",
				"method": "POST",
				"timeout": 0,
				"headers": {
					"Ocp-Apim-Subscription-Key": "545279035abb4093ad17a0b7e0fbac55",
					"Content-Type": "application/json-patch+json",
					"Cache-Control": "no-cache"
				},
				"data": JSON.stringify({
					"Item1": [
						postID
					],
					"Item2": [],
					"Item3": [],
					"Item4": []
				}),
			};
			$.ajax(settings).done(function (response) {
				console.log(response);
				$("#post").html(response.reportHeader.postHeader[0].postName);
				let ttlpotevacuees = "<div><span class='text-muted'>Total Potential Evacuees:</span> "+addCommas(response.reportSections[0].reportData.fields[0].value)+"</div>";
				let ttlcitizens = "<div><span class='text-muted'>Total U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[1].value)+"</div>";
				let ttlnoncitizens = "<div><span class='text-muted'>Total Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[2].value)+"</div>";
				let ttlpotevacueescom = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Require to Evacuate:</span> "+addCommas(response.reportSections[0].reportData.fields[3].value)+"</div>";
				let usgemp = "<div><span class='text-muted'>USG Employees:</span> "+addCommas(response.reportSections[0].reportData.fields[4].value)+"</div>";
				let familymem = "<div><span class='text-muted'>Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[5].value)+"</div>";
				let tcncont = "<div><span class='text-muted'>TCN Contractors:</span> "+addCommas(response.reportSections[0].reportData.fields[6].value)+"</div>";
				let tcncontfamily = "<div><span class='text-muted'>TCN Contractors Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[7].value)+"</div>";
				let ttlevacuees = "<div><span class='text-muted'>Total Potential Evacuees Who the COM May Not Require to Evacuate</span> "+addCommas(response.reportSections[0].reportData.fields[8].value)+"</div>";
				let citizens = "<div><span class='text-muted'>U.S. Citizens (Residents and Visitors):</span> "+addCommas(response.reportSections[0].reportData.fields[9].value)+"</div>";
				let noncitizens = "<div><span class='text-muted'>Non-U.S. Citizens:</span> "+addCommas(response.reportSections[0].reportData.fields[10].value)+"</div>";
				let ttlfamilymen = "<div><span class='text-muted'>Regional COCOM Family Members:</span> "+addCommas(response.reportSections[0].reportData.fields[11].value)+"</div>";
				let ttlpeacecorp = "<div><span class='text-muted'>Peace Corps Volunteers and Trainees:</span> "+addCommas(response.reportSections[0].reportData.fields[12].value)+"</div>";
				$("#f77-post-report").html(ttlpotevacuees+ttlcitizens+ttlnoncitizens+ttlpotevacueescom+usgemp+familymem+tcncont+tcncontfamily+ttlevacuees+citizens+noncitizens+ttlfamilymen+ttlpeacecorp);
				$("#f77-post-approval-date").html("<span class='text-muted'>Report Date: </span>"+moment(response.reportHeader.postHeader[0].approvalDate).format('YYYY-MM-DD'));
			}).fail(function () {
				$("#f77-post-report").html("<i class='fa-solid fa-bug'></i> Error. Missing data.");
			});
		}
		
		function addCommas(nStr) {
			nStr += '';
			x = nStr.split('.');
			x1 = x[0];
			x2 = x.length > 1 ? '.' + x[1] : '';
			var rgx = /(\d+)(\d{3})/;
			while (rgx.test(x1)) {
				x1 = x1.replace(rgx, '$1' + ',' + '$2');
			}
			return x1 + x2;
		}
	
		function printJustDIV(printdivname) {
			var headstr = "<html><head><title>Booking Details</title></head><body>";
			var footstr = "</body>";
			var newstr1 = document.getElementById(printdivname).innerHTML;
			var oldstr = document.body.innerHTML;
			document.body.innerHTML = headstr+newstr1+footstr;
			window.print();
			document.body.innerHTML = oldstr;
			window.location.reload(true);
		}

</script>
</body>
</html>